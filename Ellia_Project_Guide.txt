# 엘리아 프로젝트 통합 가이드
# 최종 업데이트: 2026-01-31

################################################################################
#                              [PART 1] 프로젝트 개요
################################################################################

================================================================================
[1-1] 프로젝트 정보
================================================================================
- 캐릭터: 엘리아 (28세, 전직기사, 아내)
- 플랫폼: ProChat (AI RP 서비스)
- 목표: 이미지 자동 생성 + RP 시스템 구축

================================================================================
[1-2] 주요 파일 위치
================================================================================
## 메인 프롬프트 & 키워드북
- 메인 프롬프트: C:\Users\HG\Documents\GitHub\U\Ellia_RP_System_v3.0_draft.txt
- 키워드북: C:\Users\HG\Documents\GitHub\U\Ellia_Keyword_Books.txt
- 시작 시나리오: C:\Users\HG\Documents\GitHub\U\Ellia_Start_Scenario.txt
- 통합 가이드: C:\Users\HG\Documents\GitHub\U\Ellia_Project_Guide.txt (본 파일)

## 이미지 생성 스크립트 (ComfyUI)
- NSFW 전용: C:\Users\HG\Documents\ComfyUI\ellia_auto_generator_US.py
- NSFW+Safe 통합: C:\Users\HG\Documents\ComfyUI\ellia_auto_generator_US_all_edition.py
- 폴더 재생성: C:\Users\HG\Documents\ComfyUI\ellia_regenerate_from_folder.py
- 자동 검열: C:\Users\HG\Documents\ComfyUI\ellia_auto_censor.py

## GitHub (이미지 호스팅)
- Base URL: https://raw.githubusercontent.com/wcompany-crack/U/main/
- Safe 폴더: /A/, /B/, /C/
- Adult 폴더: /H/M/, /H/S/, /H/O/, /H/P1/, /H/X/

################################################################################
#                              [PART 2] 글자수 측정 기준
################################################################################

================================================================================
[2-1] Windows 11 메모장 글자수 기능
================================================================================
- 2024년 업데이트로 메모장에 글자수 카운트 기능 추가됨
- 상태바에서 확인 가능
- 텍스트 선택 시: 선택된 문자 수 + 전체 문자 수 표시
- 텍스트 미선택 시: 전체 문자 수만 표시

## 측정 방식 차이
| 방식 | 설명 | 비고 |
|------|------|------|
| PowerShell (CRLF포함) | 줄바꿈을 2문자(\r\n)로 카운트 | 가장 큰 값 |
| 메모장 (Win11) | 순수 글자수만 카운트 추정 | ProChat 기준과 유사 |
| 줄바꿈 제외 | 줄바꿈 완전 제외 | 참고용 |

## ProChat 글자수 기준 (추정)
- Windows 11 메모장 카운트와 유사할 가능성 높음
- 확실한 방법: ProChat에 직접 붙여넣기 → 제한 초과 여부 확인
- 5,000자 제한에서 여유 있게 작업 권장

참고: https://www.digitaltoday.co.kr/news/articleView.html?idxno=497450

################################################################################
#                              [PART 3] 이미지 생성 프롬프트
################################################################################

================================================================================
[3-1] 토큰 제한
================================================================================
- CLIP 제한: 154 토큰 (77 x 2 인코더)
- ComfyUI는 long prompt 지원하므로 초과해도 동작함
- 단, 154 이후 토큰은 가중치 낮아짐
- 중요 태그는 프롬프트 앞쪽에 배치할 것

현재 상태 (2026-01-31):
- Positive: ~193 토큰 (초과, 하지만 중요태그 앞배치로 OK)
- Negative: ~91 토큰 (여유 있음)

================================================================================
[3-2] 프롬프트 우선순위 (앞에서부터)
================================================================================
1. CENSOR (검열 태그) - 가장 중요
2. NSFW_MALE (남캐 + 페니스 검열)
3. BASE_CHAR (캐릭터 기본 특징)
4. COSTUME (의상)
5. ACTION (행위/포즈)
6. QUALITY_TAGS (품질) - 마지막

================================================================================
[3-3] 캐릭터 학습 특성 (Ellia)
================================================================================
- 파란색 계열로 학습됨
- 앞치마/프릴이 기본적으로 나오는 경향
- 해결: 메이드복 외 의상에 negative로 "apron, frills, frilled, maid," 추가

================================================================================
[3-4] 표정 관련
================================================================================
- 모델이 기본적으로 웃는 경향 있음
- 무표정/슬픔/분노/짜증/질투 등에 (no smile:1.2~1.3) 필수
- 무표정: (emotionless:1.3), (expressionless:1.3), (no smile:1.3), (closed mouth:1.2)

================================================================================
[3-5] 손 관련
================================================================================
- 뭔가 쥐는 경향 있음
- Negative에 "holding object, holding item" 추가
- 특정 표정에 "empty hands" 추가 (유혹/도발/애교/질투 제외)
- 손 품질: (bad hands:1.3), (poorly drawn hands:1.3), (extra fingers:1.4), (missing fingers:1.4)

================================================================================
[3-6] 의상별 설정
================================================================================
N (나체):
- tags: (nude:1.3), (naked:1.3), (completely nude:1.3), bare skin,
- negative: clothes, clothing, dressed, outfit, costume,

K1 (메이드복):
- tags: maid outfit, black maid dress, white frilled apron, ...
- negative: (없음)

K2 (수영복):
- tags: white bikini, micro bikini, ...
- negative: apron, frills, frilled, maid,

K3 (란제리/바디수트):
- tags: (black bodysuit:1.3), (lace bodysuit:1.2), black lingerie, ...
- negative: apron, frills, frilled, maid,

================================================================================
[3-7] 검열 스타일 (black_heart)
================================================================================
- Nipples: (giant black heart pasties:1.8), (black heart stickers on nipples:1.8)
- Pussy: (giant black heart seal over pussy:2.0), (black heart sticker covering pussy:1.9)
- Penis: (white censor bar over penis:2.0), (white rectangle covering penis:1.9)

================================================================================
[3-8] 가슴 태그
================================================================================
현재 설정:
- (huge breasts:1.1)
- (breasts bigger than head:1.1)
- (large breasts:1.15)
- H-cup 제거됨 (효과 없음)

효과 순위: gigantic > huge > large > medium

================================================================================
[3-9] 단계별 표정 (P_ 체위용 STAGES)
================================================================================
1. 평온: (emotionless:1.3), (no smile:1.3), light blush (무표정 + 홍조)
2. 흥분: moaning, heavy breathing, sweat, heart marks
3. 절정: ahegao, tongue out, rolling eyes, drooling
4. 사후: afterglow, exhausted, satisfied, cum dripping

################################################################################
#                              [PART 4] 이미지 시스템
################################################################################

================================================================================
[4-1] 파일명 구조
================================================================================
- Safe: {복장}_{상황}_{표정}_{시간}.webp (예: A_01_a_1.webp)
- M감정: M_{번호}_{옵션}_{반복}.webp (예: M_03_K1_a.webp)
- S솔로: S_{번호}_{옵션}_{반복}.webp (예: S_07_N_a.webp)
- O봉사: O_{번호}_{옵션}_{반복}.webp (예: O_03_N_a.webp)
- P체위: P_{번호}_{시간}_{상태}_{옵션}_{반복}.webp (예: P_01_1_1_N_a.webp)
- X특수: X_{번호}_{반복}.webp (예: X_09_a.webp)

================================================================================
[4-2] 총 이미지 수 (repeat=1 기준)
================================================================================
NSFW:
- M (감정): 15 x 4 = 60
- S (솔로): 15 x 4 = 60
- O (봉사): 18 x 4 = 72
- P (체위): 21 x 2 x 4 x 4 = 672
- X (특수): 17
- 소계: 881장

Safe:
- 9복장 x 유효상황 x 16감정 x 2시간 = 1,376장

총합: 2,257장

================================================================================
[4-3] 의상 옵션
================================================================================
- K1: 메이드복
- K2: 수영복
- K3: 란제리/바디수트
- N: 나체

================================================================================
[4-4] 스크립트 파일
================================================================================
- ellia_auto_generator_US.py: NSFW 전용
- ellia_auto_generator_US_all_edition.py: NSFW + Safe 통합
- ellia_regenerate_from_folder.py: 폴더 기반 재생성 (시드 유지)
- ellia_auto_censor.py: NudeNet AI 자동 검열

################################################################################
#                              [PART 5] ProChat 키워드북 시스템
################################################################################

================================================================================
[5-1] 제한사항
================================================================================
- 메인 프롬프트: 5,000자
- 키워드북: 400자/개, 최대 20개
- 동시 활성화: 최대 3개
- 우선순위: 번호 낮을수록 높음 (1→10)
- 트리거: 부분 매칭 (예: "삽입" → "삽입해", "깊이삽입" 전부 인식)

================================================================================
[5-2] 키워드북 구성 (10개)
================================================================================
| # | 키워드 | 내용 |
|---|--------|------|
| 1 | Safe, 일반, 일상 | Safe 이미지 유효조합 |
| 2 | M, 감정, 표정 | M폴더 감정표현 코드 |
| 3 | S, 솔로, 자위 | S폴더 솔로플레이 코드 |
| 4 | O, 봉사, 페라 | O폴더 봉사플레이 코드 |
| 5 | P, 체위, 삽입 | P폴더 체위 코드 |
| 6 | X, 특수, 상황 | X폴더 특수상황 코드 |
| 7 | 임신, 수유, 모유 | 임신/수유 옵션 상세 |
| 8 | 성인, 묘사, 야한 | 성인묘사 핵심 가이드 |
| 9 | 반응, 대사 | 단계별 반응/대사 예시 |
| 10 | 여관, 운영, 손님 | 여관 운영 시스템 |

================================================================================
[5-3] 키워드 충돌 해결 기록
================================================================================
- 기존 문제: 5번과 8번 모두 "섹스" 키워드 → 충돌
- 해결: 5번에서 "섹스" 제거, 8번 "섹스"→"야한" 변경

================================================================================
[5-4] 외부 URL 관련
================================================================================
- Claude Code: WebFetch로 GitHub raw URL 읽기 가능
- Python 스크립트: requests 라이브러리로 fetch 가능
- ProChat/Gemini: HTTP 요청 불가, URL 내용 못 읽음
- 마크다운 ![]() 구문: 이미지 전용, 텍스트 파일은 렌더링 안 됨
- 해결책: 키워드북에 필요한 정보 직접 입력

################################################################################
#                              [PART 6] 프롬프트 최적화 이력
################################################################################

================================================================================
[6-1] 수정 기록
================================================================================
1. 무표정(M_01) 웃음 문제 → (emotionless:1.3), (no smile:1.3) 추가
2. 손에 물건 쥐는 문제 → "holding object, holding item" 네거티브 추가
3. 나체에 옷 나오는 문제 → nude 태그 강화 (1.3), 의상 네거티브 추가
4. K2/K3에 앞치마 나오는 문제 → "apron, frills, frilled, maid" 네거티브 추가
5. 란제리 느낌 부족 → 바디수트 스타일로 변경
6. 가슴 크기 조정 → huge:1.1, large:1.15, H-cup 제거
7. 평온 단계 표정 → (emotionless:1.3), (no smile:1.3), light blush 추가
8. 손 품질 → (bad hands:1.3), (poorly drawn hands:1.3), (extra fingers:1.4) 추가

################################################################################
#                              [PART 7] 진행 상황
################################################################################

================================================================================
[7-1] 완료
================================================================================
- 이미지 생성 스크립트 최적화
- 프롬프트 토큰 최적화
- 메인 프롬프트 v3.0 작성
- 키워드북 10개 구성
- 키워드 충돌 해결
- 상태창 포맷 업데이트 (게이지 바, 트리 구조)
- 시간 시스템 압축 (4단계→2단계: 낮/밤)
- 5년차 부부 디테일 추가
- 나레이션 규칙 정리 + 금지사항 샌드위치 강조
- 스토리 몰입 요소 추가 (소꿉친구설정, 오감, 신체언어, 감정누적)
- NPC 상세화 (릴리/마커스/로드릭)
- 상태창에 감정누적 게이지 추가
- 나이 수정 (28세→26세)
- 키워드북 10번 NPC 정보 추가

================================================================================
[7-2] 진행중
================================================================================
- ProChat 실제 테스트
- 이미지 생성 및 업로드

================================================================================
[7-3] 예정
================================================================================
- 키워드 발동 빈도 테스트
- 필요시 키워드 조정
- 사용자 피드백 반영

################################################################################
#                              [END OF DOCUMENT]
################################################################################
